(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{388:function(e,t,a){"use strict";a.r(t);var s=a(45),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"challenge-03-create-and-deploy-your-first-arm-template"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#challenge-03-create-and-deploy-your-first-arm-template"}},[e._v("#")]),e._v(" Challenge_03 Create and deploy your first ARM Template")]),e._v(" "),a("p",[e._v("In this challenge we want to deploy our first ARM template. To keep things as\nsimple as possible an ARM Template which describes an Azure Storage Account\nis already prepared for you.")]),e._v(" "),a("p",[e._v("Open a shell and navigate to the "),a("strong",[e._v("iac-basics-workshop")]),e._v(" folder on your local\nmachine and open VS Code:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("code "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n")])])]),a("h2",{attrs:{id:"add-a-parameter-and-reference-it"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#add-a-parameter-and-reference-it"}},[e._v("#")]),e._v(" Add a parameter and reference it")]),e._v(" "),a("p",[e._v("You can find the template under\n"),a("strong",[e._v("challenges/templates/challenge_03/storage.json")]),e._v(". Open the file and have a\nlook at it. The template is a static one, because no parameters can be passed\nduring deployment time. We will now add a parameter that will allow us to set\nthe name of the storage account at deployment time. If you have installed the\nARM template extension correctly, it will help you to add and reference the\nparameter.")]),e._v(" "),a("p",[e._v("Add the parameter ...")]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[e._v("  "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"parameters"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"storageAccountName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"string"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"metadata"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"description"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"description"')]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("... and reference it.")]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("\"[parameters('storageAccountName')]\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n")])])]),a("h2",{attrs:{id:"deploy-the-arm-template-to-azure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deploy-the-arm-template-to-azure"}},[e._v("#")]),e._v(" Deploy the ARM Template to Azure")]),e._v(" "),a("p",[e._v("To deploy the ARM Template we need to login to Azure first. Use the Azure CLI\nand the "),a("strong",[e._v("login")]),e._v(" command to authenticate:")]),e._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("az login\n")])])]),a("p",[e._v("After you have logged in, check if we use the right Azure subscription:")]),e._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("az account show -o table\n")])])]),a("p",[e._v("If you ar not connected to the right subscription use the "),a("strong",[e._v("account set")]),e._v("\ncommand and specify the id of the desired Azure subscription:")]),e._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("az account "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" -s "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("your subscription id"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])]),a("p",[e._v("Create a resource group with the "),a("strong",[e._v("group create")]),e._v(" command:")]),e._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("az group create -n "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("RG name"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" -l "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("location"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])]),a("p",[e._v("Now we can deploy the ARM Template, but of course we want to see what changes\nthe template would cause. With the Azure CLI "),a("strong",[e._v("deployment group create")]),e._v("\ncommand we can deploy the template to an Azure resource group and with the\nparameter "),a("strong",[e._v("--confirm-with-what-if")]),e._v(" we can first check what will happen if\nwe deploy the template:")]),e._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("az deployment group create -n demo01 -g "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("RG name"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("  --template-file ./storage.json --parameters "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("storageAccountName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("your name"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" --confirm-with-what-if\n")])])]),a("p",[e._v("This call will output the following:")]),e._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("Resource and property changes are indicated with this symbol:\n  + Create\n\nThe deployment will update the following scope:\n\nScope: /subscriptions/"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("/resourceGroups/"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("rg"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n\n  + Microsoft.Storage/storageAccounts/anm4211 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("-06-01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n\n      apiVersion: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2019-06-01"')]),e._v("\n      id:         "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/subscriptions/<id>/resourceGroups/<rg>/providers/Microsoft.Storage/storageAccounts/<name>"')]),e._v("\n      kind:       "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"StorageV2"')]),e._v("\n      location:   "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"westeurope"')]),e._v("\n      name:       "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"<name>"')]),e._v("\n      sku.name:   "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Standard_LRS"')]),e._v("\n      type:       "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Microsoft.Storage/storageAccounts"')]),e._v("\n\nResource changes: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" to create.\n\nAre you sure you want to execute the deployment? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("y/n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(": n\n")])])]),a("p",[e._v("If you are happy with the changes enter 'y' and start the deployment.")]),e._v(" "),a("h2",{attrs:{id:"check-the-deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#check-the-deployment"}},[e._v("#")]),e._v(" Check the deployment")]),e._v(" "),a("p",[e._v("Now navigate to the Azure Portal, go to your Resource Group and you will see\nthat the Storage Account is there.")]),e._v(" "),a("h2",{attrs:{id:"housekeeping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#housekeeping"}},[e._v("#")]),e._v(" Housekeeping")]),e._v(" "),a("p",[e._v("Before we go on to the next challenge, delete your resource group using Azure\nCLI and the "),a("strong",[e._v("group delete")]),e._v(" command:")]),e._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("az group delete -n "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("RG name"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);